!function(){"use strict";function a(r,a,o,t,s,n,e,i,u){var p,d=this;function l(){d.subTotalCart=0,d.shoppingCarts.forEach(a=>{d.subTotalCart=d.subTotalCart+a.subPrice})}return d.cartQty=0,d.subTotalCart=0,d.isBegining=!0,r.status={isopen:!1},d.addChart=[],d.shoppingCarts=[],d.listMenu=[],d.listMixMenu=[],d.listHampresMenu=[],d.listFrozenMenu=[],d.model={},d.opts=o.singleDateFormat(o.l.DATEFORMAT),d.model.orderDate=o.l.getDate(),s.$on("sendToNavbar",function(a,t){r.info=!0,r.$apply(()=>{d.cartQty=t.cartQty,d.addChart=t.addChart,d.listMenu=t.listMenu,d.listMixMenu=t.listMixMenu,d.listHampresMenu=t.listHampresMenu,d.listFrozenMenu=t.listFrozenMenu})}),d.generateShoopingCart=function(){d.shoppingCarts=[];for(let a=0;a<d.addChart.length;a++){var t={},n=d.addChart[a].productMenuId,e=d.listMenu.concat(d.listMixMenu,d.listHampresMenu,d.listFrozenMenu),t=_.find(e,function(a){return a.productMenuId==n});null==_.find(d.shoppingCarts,function(a){return a.productMenuId==n})?(t.qty=1,t.subPrice=t.discountPrice,d.shoppingCarts.push(t)):(e=_.findIndex(d.shoppingCarts,function(a){return a.productMenuId==n}),d.shoppingCarts[e].qty++,d.shoppingCarts[e].subPrice=d.shoppingCarts[e].qty*d.shoppingCarts[e].discountPrice)}l()},d.addQtyItem=function(a,t){let n=_.findIndex(d.shoppingCarts,function(a){return a.productMenuId==t}),e=_.findIndex(d.addChart,function(a){return a.productMenuId==t});"add"==a?50==d.shoppingCarts[n].qty?o.Alert.error("Maximal order adalah 50 pack"):(d.shoppingCarts[n].qty++,d.shoppingCarts[n].subPrice=d.shoppingCarts[n].qty*d.shoppingCarts[n].discountPrice):1==d.shoppingCarts[n].qty?o.Alert.confirm("Hapus dimsum","Apakah anda yakin menghapus order ini?",function(a){a.isConfirmed&&(1<d.shoppingCarts.length?r.$apply(()=>{d.shoppingCarts.splice(n,1),d.addChart.splice(e,1),d.cartQty--}):r.$apply(()=>{d.shoppingCarts=[],d.addChart=[],d.cartQty=0,d.subTotalCart=0,d.model={}}),s.$broadcast("sendToMenu",{cartQty:d.cartQty,addChart:d.addChart,shoppingCarts:d.shoppingCarts}))}):(d.addChart.splice(e,1),d.shoppingCarts[n].qty--,d.shoppingCarts[n].subPrice=d.shoppingCarts[n].qty*d.shoppingCarts[n].discountPrice),l()},d.checkOut=function(){d.model.shoppingCarts=[],d.model.shoppingCarts=d.shoppingCarts,d.model.subTotalCart=d.subTotalCart;var a=null==d.model.orderDate?"Tolong masukkan tanggal pemesanan":null==d.model.name?"Tolong masukkan nama anda":null==d.model.noHp?"Tolong masukkan nomor anda (yang terhubung dengan WA)":0==d.shoppingCarts.length?"Anda belum ada masukkan pesanan dimsum, silahkan tambah terlebih dahulu.":0==o.validasiNomorSeluler(d.model.noHp)?"Format nomor yang anda masukkan salah. Pastikan nomor anda aktif dan terdaftar provider di Indonesia.":"";a?o.Alert.error(a):(a=(Math.random()+1).toString(36).substring(2),o.setLocalStorage(a,d.model),a=CryptoJS.AES.encrypt(a,"kNISDIqad91210201013lz821b"),$state.go("app.pages.checkout",{id:a}),$("#shoppingCartModal").modal("toggle"))},d.changeMenu=function(a){d.bar=a},d.logout=function(){a.go("login"),i.remove("token"),i.remove("User"),n.localStorage.clear()},d.init=void(null==(p=n.localStorage.getItem("user"))?d.isBegining=!0:(d.isBegining=!1,e(function(){d.user=JSON.parse(p),null==d.user.parentMemberName&&(d.user.parentMemberName=d.user.memberName,d.user.memberName="Balikpapan")},0),u.generateMenu(r),u.refreshActiveMenu())),d}angular.module("ummuza").controller("navBarCtrl",a),a.$inject=["$scope","$state","farst","HttpService","$rootScope","$window","$timeout","$cookies","navService"]}();