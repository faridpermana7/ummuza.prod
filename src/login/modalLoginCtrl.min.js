!function(){"use strict";function e(a,e,t,s,o,r,u,n,c,d,l,i,g,p){var m=this,h=n.config.getApiUrl()+"/token";return m.model={username:void 0,password:void 0,grant_type:"password"},m.isRegistered=!1,m.isOpen=!1,m.validate=function(){o.validateLocal()&&t.go("app.main.page")},m.signinStart=function(){m.isLoading=!0},m.signinFinished=function(){m.isLoading=!1},m.mappingTabs=function(e){m.isRegistered="reg"==e},m.signin=function(){try{m.signinStart(),m.signinSvc(m.model,function(e){e.auth?(m.signinFinished(),"login"==t.current.name?t.go("app.main.page"):m.isOpen=!1):(m.signinFinished(),console.log(e),s.Alert.error("Username, password or member code doesn't match! Please provide check your login information."))})}catch(e){m.signinFinished(),s.Alert.error("Please reach your account manager about Login:500!")}},m.signinSvc=function(e,n=void 0){o.skipInterceptor=!0;var i=u.defer(),t=h,e=c(e);return delete r.defaults.headers.common["X-Requested-With"],r({method:"POST",url:t,data:e,timeout:i.promise,headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(t){try{if(null!=n)if("invalid_grant"==t.data.error)m.signinFinished(),s.Alert.error(t.data.error_description);else{if(200==t.status){if(400==t.data.statusCode)return m.signinFinished(),void s.Alert.error(t.data.message);o.setAccessToken(t.data.data.token),d.localStorage.setItem("user",t.data.data.userInfo),d.localStorage.setItem("userMenu",t.data.data.menu)}setTimeout(function(){n({auth:200==t.status,status:t.status,response:t}),l.callbackNotifyLoginSuccess(),o.skipInterceptor=!1,i.resolve(t),p(function(){g.generateMenu(a)},300),console.log("success")})}}catch(e){null!=n&&n({auth:200==t.status,status:t.status,response:t}),o.skipInterceptor=!1}},function(e){null!=n&&n({auth:200==e.status,status:e.status,response:e}),o.skipInterceptor=!1,i.reject()}),i.promise},m.signout=function(){},m.changeState=function(e){401!=e||m.isOpen||(m.isOpen=!0)},m.isStatePushed=!1,a.$on("$destroy",function(){l.clearCallback()}),m.init=(n=o,"login"==t.current.name&&(m.isOpen=!0),void(m.isStatePushed||(n.authChangeState.push(m.changeState),m.isStatePushed=!0))),m}angular.module("ummuza").controller("modalLoginCtrl",e),e.$inject=["$scope","$stateParams","$state","farst","HttpAuthInterceptorService","$http","$q","ConfigService","$httpParamSerializer","$window","modalLoginService","pendingRequest","navService","$timeout"]}();