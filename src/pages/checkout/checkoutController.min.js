!function(){"use strict";angular.module("ummuza").controller("checkCtrl",e);function e(r,i,e,n,t){var l,d,s=this,o=(s.param=t.id,i.option.maxboxUrl),a=i.option.maxboxAttrib,u=i.option.accessToken,m=i.option.defaultLat,c=i.option.defaultLong,t=(s.codeEnabled=!0,s.param.replace(/\s/g,"+")),t=CryptoJS.AES.decrypt(t,"kNISDIqad91210201013lz821b").toString(CryptoJS.enc.Utf8);function p(e){var e=(e+"").split(".",2),t=e[1].substr(0,5),e=e[0]+"."+t;return parseFloat(e)}function g(e,t){s.model.address="",$.get("https://nominatim.openstreetmap.org/reverse?format=jsonv2&lat="+e+"&lon="+t,function(e){var t=e.address.building,o=e.address.road,a=", ",n=e.address.village+a+e.address.city+a+e.address.state+a+e.address.postcode+" "+e.address.country;e.address.amenity&&(t=e.address.amenity),r.$apply(()=>{s.model.address=null!=t&&null!=o?t+a+o+a+n:null!=t&&null==o?t+a+n:null==t&&null!=o?o+a+n:n})})}function v(e){var t,o;s.model.isHaveGeoPoint&&(d&&l.removeLayer(d),t=p(e.latlng.lat),o=p(e.latlng.lng),l.panTo(new L.LatLng(t,o)),(d=new L.marker([t,o],{draggable:!0})).on("dragend",f),d.addTo(l),d.bindPopup("<b>Alamat saya disini</b>.").openPopup(),s.model.isHaveGeoPoint)&&n(function(){s.model.latitude=t,s.model.longitude=o,g(t,o)},0)}function f(e){var t=e.target.getLatLng();n(function(){s.model.latitude=p(t.lat),s.model.longitude=p(t.lng)},0)}return s.model=i.getLocalStorage(t),s.model.isHaveGeoPoint=!0,s.setMarker=function(e,t,o,a){s.model.isHaveGeoPoint&&(d&&l.removeLayer(d),s.model.latitude=p(e),s.model.longitude=p(t),l.panTo(new L.LatLng(e,t)),o&&l.flyTo(new L.LatLng(e,t),o),(d=new L.marker([s.model.latitude,s.model.longitude],{draggable:!0})).on("dragend",function(e){var t=e.target.getLatLng();n(function(){s.model.latitude=t.lat,s.model.longitude=t.lng},0)}),d.addTo(l),l.addLayer(d),g(s.model.latitude,s.model.longitude),(a?d.bindPopup("<b>Lokasi</b>. <br/>"+a):d.bindPopup("<b>Lokasi</b>. <br/>")).openPopup())},s.getCurrentLocation=function(){navigator.geolocation?navigator.geolocation.getCurrentPosition(function(e){s.model.latitude=e.coords.latitude,s.model.longitude=e.coords.longitude,s.setMarker(e.coords.latitude,e.coords.longitude,17,"lokasi saya")},function(e){i.Alert.error(e.message)}):i.Alert.error("Geolocation is not supported by this browser.")},s.convertLinkGoogleMaps=function(e){var t=e.originalEvent.clipboardData.getData("text/plain"),e=function(e){var t="",e=e.split("/")[5];e&&(e=e.split("+"),t=e.join(" "));return t}(t),o=/![34]d(-?[\d\.]+)/g,a=[],n=o.exec(t);if(null!=n){for(;null!==n;)a.push(n[1]),n=o.exec(t);1<a.length&&s.setMarker(a[0],a[1],17,e)}else i.Alert.error("location not found")},s.setmap=function(){l=new L.map("mapid").setView([m,c],11),L.tileLayer(o,{attribution:a,tileSize:512,maxZoom:18,zoomOffset:-1,id:"mapbox/streets-v11",accessToken:u}).addTo(l),l.on("click",v)},s.model.paymentMethod="transfer",s.model.ongkir=0,s.model.grandTotal=s.model.subTotalCart+s.model.ongkir,s.choosePaymentMethod=function(e){s.model.paymentMethod=e,s.model.grandTotal=s.model.subTotalCart+s.model.ongkir},s.printDiv=function(){var o=$("#textAreaCopy").replaceWith("<div id='divForTACopy' class='divTextArea'>"+$("#textAreaCopy").val().replace(/\n/g,"<br>")+"</div>"),a=$("#textArea").replaceWith("<div id='divForTA' class='divTextArea'>"+$("#textArea").val().replace(/\n/g,"<br>")+"</div>");html2canvas($("#DivIdToPrint")[0],{useCORS:!0,allowTaint:!1,ignoreElements:e=>"IFRAME"===e.nodeName}).then(e=>{$("#divForTACopy").replaceWith(o),$("#divForTA").replaceWith(a),$("#out_image").append(e);var t=document.createElement("a");t.href=e.toDataURL("image/jpeg").replace("image/jpeg","image/octet-stream"),t.download=s.model.name+"_"+s.model.orderDate+"_invoice.jpg",t.click()})},s.init=void s.setmap(),s}e.$inject=["$scope","farst","HttpService","$timeout","$stateParams"]}();